# ü™∂ MyCoder ULTRA-LIGHTWEIGHT verze
# Pro slab≈°√≠ hardware - minim√°ln√≠ spot≈ôeba zdroj≈Ø
version: '3.8'

services:
  mycoder-light:
    build: 
      context: .
      dockerfile: Dockerfile.lightweight
    container_name: mycoder-light
    ports:
      - "8000:8000"    # MyCoder API
      - "11434:11434"  # Ollama API
    volumes:
      - mycoder_light_data:/home/mycoder/.ollama
      - ./workspace:/app/workspace
      - ./logs:/app/logs
    environment:
      - OLLAMA_HOST=0.0.0.0
      - MYCODER_MODE=DEGRADED          # Degraded mode = m√©nƒõ funkc√≠, v√≠c √∫spora
      - MYCODER_LLM_PROVIDER=ollama
      - MYCODER_LLM_MODEL=tinyllama:1.1b  # Nejmen≈°√≠ model!
      - OLLAMA_MAX_LOADED_MODELS=1      # Jen 1 model v pamƒõti
      - OLLAMA_NUM_PARALLEL=1           # Jen 1 paraleln√≠ request
    deploy:
      resources:
        limits:
          cpus: '2.0'      # Max 2 CPU cores
          memory: 4G       # Max 4GB RAM
        reservations:
          cpus: '1.0'      # Min 1 CPU core  
          memory: 2G       # Min 2GB RAM
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:11434/api/tags"]
      interval: 60s      # M√©nƒõ ƒçast√Ω health check
      timeout: 10s
      retries: 3
      start_period: 120s
    restart: unless-stopped
    command: ["lightweight"]

volumes:
  mycoder_light_data:
    name: mycoder-lightweight-data

networks:
  default:
    name: mycoder-light-network

# ü™∂ POU≈ΩIT√ç ULTRA-LIGHTWEIGHT:
# 
# docker-compose -f docker-compose.lightweight.yml up
# 
# Nebo p≈ôes Makefile:
# make light
#
# üìä SPOT≈òEBA ZDROJ≈Æ:
# - RAM: 2-4GB (m√≠sto 8-16GB)
# - CPU: 1-2 cores (m√≠sto 4-8)  
# - Model: 637MB (m√≠sto 776MB+)
# - Disk: ~3GB celkem (m√≠sto 10GB+)
#
# ‚ö†Ô∏è TRADE-OFFY:
# - Men≈°√≠ kvalita k√≥du (TinyLlama vs DeepSeek)
# - Pomalej≈°√≠ response (degraded mode)
# - M√©nƒõ funkc√≠ (z√°kladn√≠ generov√°n√≠ jen)
#
# ‚úÖ V√ùHODY:
# - Neresetuje poƒç√≠taƒç! üéâ
# - Rychl√Ω start
# - Minim√°ln√≠ spot≈ôeba
# - St√°le funkƒçn√≠ AI asistent